var controllers = angular.module('controllers', []);

var UPLOAD_URL = 'http://gooberapp.cloudapp.net/upload';

controllers.controller("IndexCtrl", [
  '$scope',
  '$http',
  function($scope, $http) {

    function onSuccess(file) {
      // alert("trying");
      // var fd = new FormData();
      // fd.append("image", file);
      // var fd = {'image': file};
      // alert("more trying");

      // $http.post(UPLOAD_URL, JSON.stringify(fd), {
      //   withCredentials: true,
      //   headers: {'Content-Type': 'application/json'},
      //   transformRequest: angular.identity
      // }).success(function (resp) {
      //   alert('uploaded');
      // }).error(function (msg) {
      //   alert('something went wrong: ' + msg);
      // });

      //   var ft = new FileTransfer(),
      //       options = new FileUploadOptions();
      //   options.fileKey = "image";
      //   options.fileName = 'image.jpg'; // We will use the name auto-generated by Node at the server side.
      //   options.mimeType = "image/jpeg";
      //   options.chunkedMode = false;
      //   options.params = {};
      //   ft.upload(file, UPLOAD_URL,
      //             function (e) {
      //               alert('success');
      //             },
      //             function (e) {
      //               alert("Upload failed");
      //             }, options);
      // }
    }

    function onFail(msg) {
      alert("failed because: " + msg);
    }

    function getPhotoForType(type) {
      navigator.camera.getPicture(onSuccess, onFail, {
        quality: 100,
        destinationType: Camera.DestinationType.DATA_URL,
        sourceType: type
      });
    }

    function uploadPhoto() {
      return getPhotoForType(Camera.PictureSourceType.PHOTOLIBRARY);
    }

    function takePhoto() {
      return getPhotoForType(Camera.PictureSourceType.CAMERA);
    }

    // $scope.uploadPhoto = uploadPhoto;
    // $scope.takePhoto = takePhoto;
    $scope.takePhoto = onSuccess('foo.jpg');
  }
]);
